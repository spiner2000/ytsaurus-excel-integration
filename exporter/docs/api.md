# API

## Export static table

**GET \<cluster\>/api/export** — export the rows of the table (or the intersection with a subset of columns) in the specified range to Excel.

### Request

Has the following parameters
* (required) **path** — rich ypath path to the table
* (optional) **number_precision_mode** — mode for processing of numbers that cannot be exported to Excel without loss of precision

example path:
```
&path=<file_name=accounts.xlsx>//home/table{"id","survey_id"}[#2:#4]
```

* column subset can be specified in braces; optional; by default all columns are exported
* row range can be specified in brackets; optional; default_begin=0, default_end=1048574 (excel_max - 2)
* file name can be specified via `@file_name` attribute; optional

**number_precision_mode** can have one of the following values:
* **string** (default) — convert large numbers to strings
* **error** — throw error when trying to convert large number
* **lose** — export large numbers with precision loss

### Response

Successful request results in 200 Ok + file. In case of error 400 or 500 is returned with a json error message.

The error is additionally added to the http headers: `X-Yt-Error`, `X-Yt-Response-Code` and `X-Yt-Response-Message`.

Resulting Excel file consists of a single sheet "Sheet1".
The first row contains the names of the columns of the table, and the second row contains YT types.
Starting from the third line there is data.
The header (and the table) contains only the requested columns.

example output as csv:
```
id,action
uint64,string
31322749,START
31324254,PAGE_SWITCH
```

Resulting file name is chosen by the following options:
1. from the `@file_name` attribute of the request `path` if any
2. from the `@file_name` attribute of the exported YT table if any
3. generated by service based on request path

The service will add `.xlsx` extension to the file name if missing.

## Export QueryTracker results

**GET \<cluster\>/api/export-query-result** — export the rows of the QueryTracker result (or the intersection with a subset of columns) in the specified range to Excel.

### Request

Has the following parameters
* (required) **query_id** — query id
* (required) **result_index** — result number
* (optional) **lower_row_index** — min exported row index (inclusive); default=0
* (optional) **upper_row_index** — max exported row index (not inclusive); default=the number of rows in the result
* (optional) **columns** — column subset to export; default=all; example: ?columns=col1&columns=col2
* (optional) **filename** — resulting file name
* (optional) **number_precision_mode** — the same as in static table request

example:
```
&query_id=abcd&result_index=0&lower_row_index=1&upper_row_index=2&columns=col1&columns=col2&columns=col3&filename=output_file&number_precision_mode=lose
```

### Response

The response is similar to the response of static table export except for the resulting file name — it is taken from an argument or generated by the service.

### Limits

Both export requests have the following limits:
* Max number of exported rows — 1048574
* Max number of exported columns — 16384
* Max output file size — 50 Mb
* Max length of a string cell — 32767; (larger strings are truncated)

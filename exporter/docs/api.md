# API

**GET \<cluster\>/api/export** - выгрузить строки таблицы (или пересечение с подмножеством колонок) в заданном диапазоне в excel.

### Request

Содержит обязательный параметр **path** - ypath путь до таблицы.

Также есть опциональный параметр **number_precision_mode** - вид обработки чисел, которые не могут быть экспортированы в excel без потери точности. Может иметь одно из значений:
* **string** (default) - преобразовывает такие числа в строки
* **error** - выбрасывает ошибку при попытке обработать такое число
* **lose** - экспортирует такие числа с потерей точности

Пример:
```
&path=<file_name=accounts.xlsx>//home/table{"id","survey_id"}[#2:#4]
```

* в фигурных скобках указывается массив с подмножеством колонок; missing => all
* в квадратных - диапазон строк; optional; default_begin=0, default_end=1048574 (excel_max - 2)
* через атрибуты можно задать имя выходного файла

### Response

В случае успеха вернётся 200 и файл, в случае ошибки - 400 или 500 и ошибка в виде json'а.

Информация об ошибке также содержится в http header'ах: `X-Yt-Error`, `X-Yt-Response-Code` и `X-Yt-Response-Message`.

Excel файл - результат содержит единственную страницу "Sheet1".
В первой строке записаны имена колонок таблицы, во второй - yt типы.
Начиная с третьей строки идут данные.
В header'е (и в таблице) присутствуют только запрошенные колонки.

Имя файла выбирается одним из следующих способов в следующем порядке
* из атрибута `@file_name` параметра `path`
* из атрибута `@file_name` YT таблицы
* генерируется сервисом

Сервис допишет `.xlsx`, если нужно.

**GET \<cluster\>/api/export-query-result** - выгрузить строки результата запроса в Query Tracker (или пересечение с подмножеством колонок) в заданном диапазоне в excel.

### Request

Содержит обязательные параметры **query_id** - ID query запроса и **result_index** - номер результата.

Также есть опциональные параметры:
* **lower_row_index** - нижняя граница диапазона строк для экспорта (включительно, нумерация с нуля); default=0
* **upper_row_index** - верхняя граница диапазона строк для экспорта (не включительно); default=количество строк в результате
* **columns** - множество строк для экспорта; default=все строки; пример записи: ?columns=col1&columns=col2
* **filename** - имя выходного файла
* **number_precision_mode** - аналогично параметру в экспорте таблицы

Пример:
```
&query_id=abcd&result_index=0&lower_row_index=1&upper_row_index=2&columns=col1&columns=col2&columns=col3&filename=output_file&number_precision_mode=lose
```

### Response

Аналогичен экспорту таблицы за исключением имени файла — имя берётся из аргумента, либо генерируется сервисом.

### Ограничения

* Максимальное число строк — 1048574
* Максимальное число столбцов — 16384
* Максимальный размер выходного файла — 50 Mb
* Максимальная длина строки в ячейке — 32767; строки длиннее 32767 обрезаются

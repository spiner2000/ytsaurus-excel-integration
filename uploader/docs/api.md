# API

**GET \<cluster\>/api/v1/upload** - загрузить строки excel таблицы (или пересечение с подмножеством колонок)
в заданном диапазоне в статическую таблицу YT со строгой схемой.

### Request

Excel файл передаётся через `multipart/form-data`; название формы - `uploadfile`.

Управляющая часть запроса передаётся через URL params:
* **path** - ypath путь до yt таблицы
* **start_row** - опциональный номер строки, с которой начнётся загрузка; дефолтное значение - 1
* **row_count** - опциональное количество строк
* **sheet** - опциональное название excel страницы; по умолчанию используется первая
* **header** - опциональный флаг, позволяющий задавать маппинг колонок в первой строке excel таблицы
* **types** - опциональный флаг, позволяющий задавать типы колонок в первой или второй строке excel таблицы
* **columns** - опциональный маппинг колонок yt -> excel, например `{"name":"A", "name2": "A", "id": "D"}`
* **append** - опциональный флаг, позволяющий дописывать строки в конец таблицы; по умолчанию таблица будет затёрта
* **create** - опциональный флаг, позволяющий создать таблицу определив схему из параметров запроса; по умолчанию ожидается, что таблица создана предварительно

Если диапазон строк не указан (`start_row=0 && row_count=0`) и `header=true`, первая строка будет пропущена.

Дефолтный маппинг колонок сопоставляет их по позиции: первая колонка в схеме будет читаться из столбца `A`, вторая из `B` и т.д.

При создании таблицы используется следующая логика по определению имён колонок YT таблицы:
* Используются значения из параметра **columns**, если указаны.
* В противном случае используются значения из первой строки Excel таблицы, если `header=true`
* Используются имена колонок Excel: `A, B, C...`

Типы колонок по умолчанию равны any.
При `types=true` типы читаются из первой строки Excel таблицы, если `header=false`, и из второй, если `header=true`.

### Response

В случае успеха вернётся 200 и файл, в случае ошибки - 400 или 500 и ошибка в виде json'а.

Информация об ошибке также содержится в http header'ах: `X-Yt-Error`, `X-Yt-Response-Code` и `X-Yt-Response-Message`.

Пример ошибки:
```
{
  "code": 1,
  "message": "Error uploading Path: //home/verytable/upload-tests/small-src, Columns: Map[id:B], StartRow: 3, RowCount: 7, Append: True",
  "attributes": {
    "host": "verytable",
    "request_id": "f1a52e34-7c43184c-9e2d0683-26bf198f"
  },
  "inner_errors": [
    {
      "code": 1,
      "message": "Bad request",
      "inner_errors": [
        {
          "code": 1,
          "message": "Unable to read rows of sheet \"abc\"",
          "inner_errors": [
            {
              "code": 1,
              "message": "Sheet abc is not exist"
            }
          ]
        }
      ]
    }
  ]
}
```

### Ограничения

* Используется только один excel sheet
* Максимальное число строк — 1048576
* Максимальное число столбцов — 16384
* Максимальный размер выходного файла — TODO
